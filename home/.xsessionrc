#!/bin/bash

add_monitor ()
{
    # $1 is monitor name... $2 is supplied to right of
    MONITOR=$1
    RESOLUTION=$(xrandr -q | grep -A1 $MONITOR | grep -v $MONITOR | sed 's/\(x\|*\|+\|.00\)/ /g;s/^[ \t]*//;s/[ \t]*$//;s/ \+/ /g')
    GTF_OUTPUT=$(gtf $(echo $RESOLUTION | cut -f1 -d ' ') $(echo $RESOLUTION | cut -f2 -d ' ') $(echo $RESOLUTION | cut -f3 -d ' '))
    MODE_TO_ADD=$(echo $GTF_OUTPUT | grep -o "Modeline.*" | sed 's/Modeline //g')
    MODE_NAME=\"$(echo $MODE_TO_ADD | grep -o '".*"' | sed 's/"//g')\"
    xrandr --newmode $MODE_TO_ADD
    xrandr --addmode $MONITOR $MODE_NAME
    if [ $# -eq 1 ]; then
        xrandr --output $MONITOR --mode $MODE_NAME
    else
        xrandr --output $MONITOR --mode $MODE_NAME --right-of $2
    fi
}

NUM_MONITORS=$(xrandr -q | grep connected | wc -l)


if [ $NUM_MONITORS -eq '1'] ; then
    add_monitor VGA-1
elif [ $NUM_MONITORS -eq '2' ] ; then
    add_monitor VGA-1
    add_monitor VGA-2 VGA-1
else
    echo 'Cannot find output monitor'
fi

exec bspwm
